<div class="bg-gradient-to-br from-white to-slate-50 rounded-2xl shadow-xl p-8 mb-8 border border-slate-200/50">
  <!-- Header -->
  <div class="mb-8">
    <h2 class="text-3xl font-black text-slate-900 mb-2">
      {{ editingTransaction ? 'âœï¸ Modifier' : 'â• Nouvelle Transaction' }}
    </h2>
    <p class="text-slate-500 text-sm">{{ editingTransaction ? 'Mettez Ã  jour votre transaction' : 'Ajoutez une nouvelle transaction Ã  votre portefeuille' }}</p>
  </div>

  <!-- Error Message -->
  <div
    *ngIf="error"
    class="mb-6 p-4 bg-gradient-to-r from-red-50 to-red-100 text-red-700 rounded-xl border border-red-200 flex items-center gap-3"
  >
    <span class="text-xl">âš ï¸</span>
    <span class="font-semibold">{{ error }}</span>
  </div>

  <!-- Form -->
  <form (ngSubmit)="onSubmit()" class="space-y-6">
    <!-- Type Selection (Recette/DÃ©pense) -->
    <div>
      <label class="block text-sm font-bold text-slate-700 mb-3 uppercase tracking-wide">Type de transaction</label>
      <div class="flex gap-3">
        <button
          type="button"
          (click)="type = 'recette'; onTypeChange()"
          [class.ring-2]="type === 'recette'"
          [class.ring-emerald-500]="type === 'recette'"
          class="flex-1 py-3  px-4 rounded-xl font-bold transition-all duration-200 transform hover:scale-105"
          [ngClass]="type === 'recette' 
            ? 'bg-gradient-to-r from-emerald-500 to-emerald-600 text-white shadow-lg shadow-emerald-500/30' 
            : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
        >
          ğŸ“ˆ Recette
        </button>
        <button
          type="button"
          (click)="type = 'depense'; onTypeChange()"
          [class.ring-2]="type === 'depense'"
          [class.ring-red-500]="type === 'depense'"
          class="flex-1 py-3 px-4 rounded-xl font-bold transition-all duration-200 transform hover:scale-105"
          [ngClass]="type === 'depense' 
            ? 'bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg shadow-red-500/30' 
            : 'bg-slate-100 text-slate-600 hover:bg-slate-200'"
        >
          ğŸ“‰ DÃ©pense
        </button>
      </div>
    </div>

    <!-- Two-column layout for date and designation -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Date -->
      <div>
        <label class="block text-sm font-bold text-slate-700 mb-2">ğŸ“… Date</label>
        <input
          type="date"
          [(ngModel)]="date"
          name="date"
          class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-100 focus:outline-none transition text-slate-900 font-semibold"
        />
      </div>

      <!-- Designation -->
      <div>
        <label class="block text-sm font-bold text-slate-700 mb-2">ğŸ“ DÃ©signation</label>
        <input
          type="text"
          [(ngModel)]="designation"
          name="designation"
          placeholder="Ex: Salaire, Courses, Loyer..."
          class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-100 focus:outline-none transition placeholder-slate-400"
        />
      </div>
    </div>

    <!-- Date -->
    <div>
      <label class="block text-sm font-semibold text-slate-700 mb-2">
        Date
      </label>
      <input
        type="date"
        [(ngModel)]="date"
        name="date"
        class="w-full px-4 py-2 border-2 border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none transition"
      />
    </div>

    <!-- Designation -->
    <div>
      <label class="block text-sm font-semibold text-slate-700 mb-2">
        DÃ©signation (description)
      </label>
      <input
        type="text"
        [(ngModel)]="designation"
        name="designation"
        placeholder="Ex: Salaire, Courses, Loyer..."
        class="w-full px-4 py-2 border-2 border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none transition"
      />
    </div>

    <!-- QuantitÃ© et Prix Unitaire -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-bold text-slate-700 mb-2">ğŸ“¦ QuantitÃ©</label>
        <input
          type="number"
          [(ngModel)]="quantite"
          name="quantite"
          min="0"
          placeholder="1"
          class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-100 focus:outline-none transition text-slate-900 font-semibold"
        />
      </div>

      <div>
        <label class="block text-sm font-bold text-slate-700 mb-2">ğŸ’° Prix Unitaire</label>
        <div class="relative">
          <input
            type="number"
            [(ngModel)]="prix_unitaire"
            name="prix_unitaire"
            step="0.01"
            min="0"
            placeholder="0.00"
            class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-100 focus:outline-none transition text-slate-900 font-semibold pr-8"
          />
          <span class="absolute right-4 top-3.5 text-slate-500 font-bold text-sm">â‚¬</span>
        </div>
      </div>
    </div>

    <!-- Montant Total Display -->
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border-2 border-blue-200">
      <p class="text-sm font-semibold text-slate-600 mb-2 uppercase tracking-wide">Montant Total</p>
      <p class="text-4xl font-black text-blue-600">{{ (quantite * prix_unitaire) | number: '1.2-2' }} <span class="text-2xl text-blue-500">â‚¬</span></p>
    </div>

    <!-- CatÃ©gorie -->
    <div>
      <label class="block text-sm font-semibold text-slate-700 mb-2">
        CatÃ©gorie
      </label>
      <div class="flex gap-2">
        <select
          [(ngModel)]="categorie_id"
          name="categorie_id"
          class="flex-1 px-4 py-2 border-2 border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none transition"
        >
          <option value="" disabled>-- SÃ©lectionner une catÃ©gorie --</option>
          <option *ngFor="let cat of filteredCategories" [value]="cat.id">
            {{ cat.nom }} ({{ cat.type }})
          </option>
        </select>
        <button
          type="button"
          (click)="toggleNewCategoryForm()"
          class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg transition"
          title="Ajouter une nouvelle catÃ©gorie"
        >
          â•
        </button>
      </div>

      <!-- Form pour crÃ©er une nouvelle catÃ©gorie -->
      <div *ngIf="showNewCategoryForm" class="mt-3 p-3 bg-green-50 rounded-lg border border-green-200">
        <div class="flex gap-2">
          <input
            type="text"
            [(ngModel)]="newCategoryName"
            name="newCategoryName"
            placeholder="Nom de la catÃ©gorie..."
            class="flex-1 px-3 py-2 border-2 border-green-300 rounded-lg focus:border-green-500 focus:outline-none"
          />
          <button
            type="button"
            (click)="createNewCategory()"
            [disabled]="creatingCategory"
            class="px-3 py-2 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg transition disabled:opacity-50"
          >
            {{ creatingCategory ? '...' : 'CrÃ©er' }}
          </button>
          <button
            type="button"
            (click)="toggleNewCategoryForm()"
            class="px-3 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold rounded-lg transition"
          >
            Annuler
          </button>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex gap-3 pt-2">
      <button
        type="submit"
        [disabled]="loading"
        [class.opacity-50]="loading"
        [class.cursor-not-allowed]="loading"
        class="flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg transition disabled:hover:bg-current"
      >
        {{ loading ? (editingTransaction ? 'Modification...' : 'CrÃ©ation...') : (editingTransaction ? 'Modifier' : 'Ajouter Transaction') }}
      </button>
      <button
        type="reset"
        (click)="editingTransaction = null"
        class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-400 transition"
      >
        {{ editingTransaction ? 'Annuler' : 'RÃ©initialiser' }}
      </button>
    </div>
  </form>
</div>
